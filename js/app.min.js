var MAPCONFIG={mapSettings:{},themes:{buildings:{custom:!0,name:"Pastatai ir statyba",id:"theme-buildings",imgUrl:"/maps_vilnius/img/statyba.png",imgAlt:"Pastatai ir statyba",layers:{administravimas:{dynimacLayerUrls:"http://zemelapiai.vplanas.lt/arcgis/rest/services/TESTAVIMAI/Demo/MapServer",featureLayerUrls:["http://zemelapiai.vplanas.lt/arcgis/rest/services/TESTAVIMAI/Pastatu_administravimas_test/MapServer/1"]}}},advertise:{custom:!0,name:"Leidimai",id:"ad",imgUrl:"/maps_vilnius/img/laisvalaikis.png",imgAlt:"Reklamos vietos"},teritory:{name:"Teritorijų planavimas",id:"teritory-planning",imgUrl:"/maps_vilnius/img/teritorijos.png",imgAlt:"Teritorijų planavimas",layers:{bpPasiulymai:{dynimacLayerUrls:"http://zemelapiai.vplanas.lt/arcgis/rest/services/BP/BP_gyv_siulymai_interaktyviam_VMS_vaizdavimas/MapServer"}}},legacyMap:{custom:!0,name:"Senoji žemėlapio versija",id:"legacy",imgUrl:"/maps_vilnius/img/old_version.png",imgAlt:"Senoji versija",url:"http://www.vilnius.lt/vmap/t1.php"},schools:{custom:!0,name:"Švietimas",id:"schools",imgUrl:"/maps_vilnius/img/svietimas.png",imgAlt:"Švietimas",layers:{mokyklos:{dynimacLayerUrls:"http://zemelapiai.vplanas.lt/arcgis/rest/services/Interaktyvus_zemelapis/Mokyklos/MapServer"}}},transport:{name:"Transportas",id:"transport",imgUrl:"/maps_vilnius/img/transportas.png",imgAlt:"Transportas",layers:{dviraciuTrasos:{dynimacLayerUrls:"http://zemelapiai.vplanas.lt/arcgis/rest/services/Aplinkosauga/dviraciai_sisp_dynamic/MapServer"},gatviuTvarkymas:{dynimacLayerUrls:"http://195.182.69.66/ArcGIS/rest/services/Interaktyviam_zemelapiui/Grinda_gatviu_tvarkymas2/MapServer"}}},demo:{name:"Demo versija",id:"demo",imgUrl:"/maps_vilnius/img/laisvalaikis.png ",imgAlt:"demo versija",layers:{demoLayer:{dynimacLayerUrls:"http://zemelapiai.vplanas.lt/arcgis/rest/services/TESTAVIMAI/Demo/MapServer"},badministravimas:{dynimacLayerUrls:"http://zemelapiai.vplanas.lt/arcgis/rest/services/Interaktyvus_zemelapis/Reklamos_registro_leidimai/MapServer"},bp:{dynimacLayerUrls:"http://zemelapiai.vplanas.lt/arcgis/rest/services/Teritorijos/VBP_LGII/MapServer"}}},bpDemo:{name:"BP demo",id:"bp",imgUrl:"/maps_vilnius/img/laisvalaikis.png ",imgAlt:"bp demo versija",layers:{bp:{dynimacLayerUrls:"http://zemelapiai.vplanas.lt/arcgis/rest/services/Teritorijos/VBP_LGII/MapServer"}}}},mapExtent:{xmin:555444.210800001,ymin:6051736.22,xmax:606967.016199999,ymax:6076388.28,spatialReference:{wkid:3346}},staticServices:{basemapUrl:"http://zemelapiai.vplanas.lt/arcgis/rest/services/Baziniai_zemelapiai/Vilnius_basemap_1000/MapServer",ortofotoUrl:"http://zemelapiai.vplanas.lt/arcgis/rest/services/Baziniai_zemelapiai/ORT5LT_2013/MapServer",geometryUrl:"http://zemelapiai.vplanas.lt/arcgis/rest/services/Utilities/Geometry/GeometryServer"},themesServices:{buildingTheme:{featureLayerBuildings:"http://zemelapiai.vplanas.lt/arcgis/rest/services/TESTAVIMAI/Pastatu_administravimas_test/MapServer/1",dynamicLayerBuildings:"http://zemelapiai.vplanas.lt/arcgis/rest/services/TESTAVIMAI/Pastatu_administravimas_test/MapServer"},dynamicLayerAdverts:"http://zemelapiai.vplanas.lt/arcgis/rest/services/Interaktyvus_zemelapis/Reklamos_registro_leidimai/MapServer",featureLayerAdverts:"http://zemelapiai.vplanas.lt/arcgis/rest/services/Interaktyvus_zemelapis/Reklamos_registro_leidimai/MapServer/0"}};Array.prototype.getUnique=function(){var a={},b=[],c=0,d=this.length;for(d;c<d;c+=1)a.hasOwnProperty(this[c]),b.push(this[c]),a[this[c]]=1;return b},window.location.hash="#",require(["dojo/i18n!esri/nls/jsapi","esri/map","esri/dijit/HorizontalSlider","dojo/_base/connect","esri/toolbars/navigation","esri/config","dojo/on","dojo/query","esri/layers/ArcGISTiledMapServiceLayer","esri/layers/ArcGISDynamicMapServiceLayer","esri/dijit/Legend","dojo/_base/array","dojo/parser","esri/dijit/Popup","esri/dijit/PopupTemplate","esri/InfoTemplate","esri/layers/FeatureLayer","dojo/_base/declare","dojo/promise/all","dojo/Deferred","dgrid/OnDemandGrid","dgrid/Selection","dojo/store/Memory","dijit/form/CheckBox","dijit/registry","esri/tasks/query","esri/tasks/QueryTask","esri/request","dojo/dom","dojo/dom-construct","dojo/dom-class","esri/renderers/ClassBreaksRenderer","esri/symbols/PictureMarkerSymbol","esri/dijit/Measurement","esri/units","esri/dijit/Search","esri/tasks/locator","esri/symbols/SimpleFillSymbol","esri/symbols/SimpleMarkerSymbol","esri/renderers/SimpleRenderer","esri/symbols/SimpleLineSymbol","esri/Color","esri/geometry/Extent","app/clusterfeaturelayer","esri/graphic","esri/graphicsUtils","dojo/dom-style","dojo/_base/fx","dojo/fx/easing","esri/dijit/Scalebar","esri/layers/LayerInfo","esri/tasks/IdentifyTask","esri/tasks/IdentifyParameters","dijit/layout/ContentPane","dijit/layout/TabContainer","dijit/layout/BorderContainer","dojo/domReady!"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_){function aa(){var a=document.getElementById("map").offsetHeight/2,b=document.getElementById("map").offsetWidth/2,c=new esri.geometry.ScreenPoint(b,a,qa.spatialReference),d=qa.toMap(c);setTimeout(function(){qa.centerAt(d)},50)}function ba(){return qa.extent.getWidth()/qa.width}function ca(){var a=h(".dijitCheckBoxInput"),b=[];l.forEach(a,function(c){c.checked&&(b.push(c.id),b.push(0)),a[0].checked?(Ba.show(),Ea.show(),Ca.show(),"ad"===ka.currentTheme()&&Ma.show()):(Ba.hide(),Ea.hide(),Ca.hide(),"ad"===ka.currentTheme()&&Ma.hide())}),0===b.length&&b.push(-1),Da.setVisibleLayers(b);var c="ad"===ka.currentTheme()?{layer:Ea}:{layer:Da};legendDijit.refresh([c])}function da(a){window.location.hash===a.currentTarget.getAttribute("href")&&(window.location.hash="#closed",a.preventDefault(),Ha.deactivate())}var ea,fa,ga,ha=[],ia={},ja={extent:new esri.geometry.Extent(MAPCONFIG.mapExtent),popupProperties:{fillSymbol:new L(L.STYLE_SOLID,new O(O.STYLE_SOLID,new P([193,39,45,1]),3),new P([129,183,206,0])),titleInBody:!1},popupDom:D.create("div",{id:"ad-popup"}),popup:function(){var a=this;return new n(a.popupProperties,a.popupDom)}},ka={_getUrlQueryName:function(a,b){b||(b=window.location.href),b=b.toLowerCase(),a=a.replace(/[\[\]]/g,"\\$&").toLowerCase();var c=new RegExp("[?&]"+a+"(=([^&#]*)|&|#|$)"),d=c.exec(b);return d?d[2]?decodeURIComponent(d[2].replace(/\+/g," ")):"":null},mapInit:function(){return new b("map",{extent:ja.extent,logo:!1,showAttribution:!1,zoom:5,infoWindow:ja.popup(),nav:!1})},currentTheme:function(){return this._getUrlQueryName("theme")},currenthemeLabel:function(){for(var a=this.currentTheme(),b=document.getElementById("theme"),c=b.getElementsByTagName("div"),d=0;d<c.length;d++)c[d].id===a?c[d].className+=" current-theme":(c[d].className=c[d].className.replace(/(?:^|\s)current-theme(?!\S)/g,""),a||(document.getElementById("theme-buildings").className+=" current-theme"))},showCursor:function(a,b){b.forEach(a,function(a,b){a.on("mouse-over",function(){qa.setMapCursor("pointer")}),a.on("mouse-out",function(){qa.setMapCursor("default")})})},createThemeDom:function(){var a=MAPCONFIG.themes,b=1;for(var c in a)if(a.hasOwnProperty(c)){var d,e,f,g,h,i;if(d=e=f=g=h=i=null,a.hasOwnProperty(c)){b++;var j;j=h=b%2>0?"align-right":"align-left",d=D.create("div",{id:a[c].id,"class":"sub-theme "+h,style:""},"theme","last"),i=a[c].url?a[c].url:"./?theme="+a[c].id,e=D.create("a",{href:i},d),g=D.create("img",{src:a[c].imgUrl,alt:a[c].imgAlt},e),f=D.create("p",{innerHTML:a[c].name},d)}}},initTheme:function(){var a,b=MAPCONFIG.themes,c=this.currentTheme(),d=function(){setTimeout(function(){h.showLegendInput(a)},500)};for(var e in b)if(b.hasOwnProperty(e)){var f=b[e].id,g=b[e].custom;if(f===c&&!g){var h=this,i=[];a=this.createDynicLayers(b[e],e);for(var j in a)a.hasOwnProperty(j)&&i.push(a[j]);i=i.reverse(),this.addDynamicLayers(i),d()}}return a},addDynamicLayers:function(a){for(var b=0;b<a.length;b++)qa.addLayer(a[b])},reorderLayers:function(){l.forEach(qa.layerIds,function(a,b){b>1&&qa.reorderLayer("dyn-demo-bp",2)})},createDynicLayers:function(a,b){var c={},d=a.layers;for(var e in d)"undefined"!=typeof e&&(c["dyn"+b+e]=new j(d[e].dynimacLayerUrls,{id:"dyn-"+b+"-"+e}),c["dyn"+b+e].configLayerName=e);return c},setOpacity:function(a){for(var b in a)a.hasOwnProperty(b)&&a[b].setOpacity(value/100)},createLayerInfosArr:function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&(a[c].layerInfos.nameGroup=c,b.push(a[c].layerInfos));return this.createLayerInfosWithGroupName(b)},createLayerInfosWithGroupName:function(a){for(var b=0;b<a.length;b++)a[b]=this.createGroupName(a[b],a[b].nameGroup);return this.createLayerInfosResultArr(a)},createLayerInfosResultArr:function(a){var b;return b=[].concat.apply([],a)},createGroupName:function(a,b){for(var c=0;c<a.length;c++)a[c].groupName=b;return a},showLegendInput:function(a){var b=this.createLayerInfosArr(a),c=l.map(b,function(a,b){var c=new x({"class":"layers-labels",tabindex:a.id.toString(),value:a.groupName,checked:!!a.defaultVisibility,id:b.toString()});a.defaultVisibility&&ha.push(a.id);var d=c.domNode,e=D.toDom("<label for='"+b+"'>"+a.name+"</label>");d.appendChild(e);var f=document.createElement("div");return f.appendChild(d),f.innerHTML}),d=C.byId("layer-list");d.innerHTML=c.join(" ");for(var e in a)a.hasOwnProperty(e)&&a[e].setVisibleLayers(a[e]._defaultVisibleLayers);var f=this.setupDefaultLegendLayers(a);if(f.length>0){var h=new k({map:qa,layerInfos:f},"legend-list");h.startup()}var i=this;g(d,"click",function(b){i.updateLayerVisibility(a,b,h,f)}),this.initIdentify(f)},setupDefaultLegendLayers:function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push({layer:a[c],title:" "});return b},updateLayerVisibility:function(a,b,c,d){var e=h(".layers-labels input");inputValues=[],visibleLayers={},l.forEach(e,function(a){a.checked&&(ha.push(a.id),inputValues.push(a.value),visibleLayers.hasOwnProperty(a.value)?visibleLayers[a.value].push(a.tabIndex):(visibleLayers[a.value]=[a.tabIndex],ia[a.value]=["-1"]))});for(var f in visibleLayers)visibleLayers.hasOwnProperty(f)&&0===visibleLayers[f].length&&visibleLayers[f].push(-1);b&&this.showHideLayers(a,this.cloneVisibleLayer(visibleLayers,ia,b),b),c.refresh(d),this.initIdentify(d)},cloneVisibleLayer:function(a,b,c){for(var d in b)if(b.hasOwnProperty(d))for(var e in a)a.hasOwnProperty(e)&&d===e?d==c.toElement.value&&(b[e]=a[e]):d===c.toElement.value&&(b[e]=["-1"]);return b},showHideLayers:function(a,b,c){for(var d in a)a.hasOwnProperty(d)&&a[d].layerInfos.nameGroup===c.toElement.value&&this.getCurrentInput(c,a[d],b)},getCurrentInput:function(a,b,c){c.hasOwnProperty(a.toElement.value)&&b.setVisibleLayers(c[a.toElement.value])},initIdentify:function(a){ea=this.getParameters(a),qa.on("click",this.executeIdentify)},getParameters:function(a){var b,c={};for(var d in a)"getUnique"!==d&&(fa=new Z(a[d].layer.url),b=new $,b.tolerance=3,b.returnGeometry=!0,b.layerIds=this.getVisibleLayerIds(a[d].layer.visibleLayers),b.layerOption=$.LAYER_OPTION_VISIBLE,b.width=qa.width,b.height=qa.height,c[a[d].layer.configLayerName]=b,c[a[d].layer.configLayerName].identifyTask=fa);return c},getVisibleLayerIds:function(a){var b=[];return l.map(a,function(a,c){b.push(a)}),b},executeIdentify:function(a){if(!Ha.activeTool){var b=[],c=function(){return ea[d].identifyTask.execute(ea[d]).addCallback(function(a){return l.map(a,function(b){defResponse=a;var c=b.feature,d=" ",e=b.layerName,f=c.attributes;c.attributes.layerName=e;for(var g in f)if(f.hasOwnProperty(g)&&"OBJECTID"!=g&&"layerName"!=g)if(Date.parse(f[g])){var h=(f[g],/(\d+)[.](\d+)[.](\d+)\s.*/);d+="<p class='bord'>"+f[g].replace(h,"$1-$2-$3")+"</br><span>"+g+"</span><p>"}else{var i="Null"===f[g]?"-":f[g];d+="<p class='bord'>"+i+"</br><span>"+g+"</span><p>"}var j=new p("<p>${layerName}</p>",d);return c.setInfoTemplate(j),E.add("ad-popup","default-popup"),c})})};for(var d in ea)if(ea.hasOwnProperty(d)){ea[d].geometry=a.mapPoint,ea[d].mapExtent=qa.extent;var e=c();b.push(e)}s(b).then(function(c){var d=[].concat.apply([],c);d.length>0&&(qa.infoWindow.setFeatures([].concat.apply([],b)),qa.infoWindow.show(a.mapPoint))})}},setDefaultSelectionSymbol:function(a){var b=new L(L.STYLE_SOLID,new O(O.STYLE_SOLID,new P([193,39,45,1]),3),new P([129,183,206,0]));a.setSymbol(b),qa.graphics.add(a)}};ka.createThemeDom(),m.parse(),ka.currenthemeLabel(),a.widgets.popup.NLS_zoomTo="Priartinti",a.widgets.popup.NLS_pagingInfo="<span class='index-total'>(${index} iš ${total})</span>";var la=C.byId("loading-gif"),ma=new esri.geometry.Extent(MAPCONFIG.mapExtent),na={fillSymbol:new L(L.STYLE_SOLID,new O(O.STYLE_SOLID,new P([193,39,45,1]),3),new P([129,183,206,0])),titleInBody:!1},oa=D.create("div",{id:"ad-popup"});popup=new n(na,oa);var pa=new M("circle",24,new O(O.STYLE_LONGDASH,new P([223,52,59,0]),3),new P([255,255,255,0]));popup.markerSymbol=pa;var qa=new b("map",{extent:ma,logo:!1,showAttribution:!1,zoom:1,infoWindow:popup,nav:!1}),ra=(new e(qa),dojo.byId("zoomfullext"));g(ra,"click",function(){var a=ma.getCenter();qa.centerAndZoom(a,0)}),qa.on("resize",function(){aa()});new X({map:qa,scalebarUnit:"metric"});f.defaults.io.proxyUrl="proxy/proxy.php",f.defaults.io.corsEnabledServers.push("http://zemelapiai.vplanas.lt");var sa=MAPCONFIG.staticServices.basemapUrl,ta=MAPCONFIG.staticServices.ortofotoUrl,ua=MAPCONFIG.themesServices.buildingTheme.featureLayerBuildings,va=MAPCONFIG.themesServices.featureLayerAdverts,wa=MAPCONFIG.themesServices.buildingTheme.dynamicLayerBuildings,xa=MAPCONFIG.themesServices.dynamicLayerAdverts,ya=MAPCONFIG.staticServices.geometryUrl,za=(new p,new i(sa,{id:"topo"})),Aa=new i(ta,{id:"orto"}),Ba=new q(ua,{id:"buildings-feat",mode:q.MODE_ONDEMAND,maxAllowableOffset:ba(),outFields:["*"]}),Ca=new q(va,{id:"adverts-feat",mode:q.MODE_ONDEMAND,outFields:["*"]}),Da=new j(wa,{opacity:1,id:"buildings-dyn"}),Ea=new j(xa,{id:"adverts"});Ea.suspend();var Fa=[za,Aa];qa.addLayers(Fa);var Ga=ka.initTheme();esri.config.defaults.geometryService=new esri.tasks.GeometryService(ya);var Ha=new H({map:qa,defaultAreaUnit:I.HECTARES,defaultLengthUnit:I.KILOMETERS,deactivate:function(){var a=this.getTool();a&&(this.setTool(a.toolName,!1),this.clearResult())}},C.byId("tools-measure"));Ha.startup();var Ia=document.getElementById("top-menu").getElementsByTagName("a");l.forEach(Ia,function(a){g(a,"click",function(){qa.infoWindow.hide(),Ha.deactivate()})}),za.show(),Aa.hide(),Aa.hide();var Ja=document.getElementById("ortofoto");g(Ja,"click",function(){"none"===dojo.byId("zem").style.display?(dojo.byId("ort").style.display="none",dojo.byId("zem").style.display="block",Aa.show(),za.hide()):(dojo.byId("ort").style.display="block",dojo.byId("zem").style.display="none",za.show(),Aa.hide())});var Ka=new J({sources:[{locator:new K("http://zemelapiai.vplanas.lt/arcgis/rest/services/Lokatoriai/PAIESKA_COMPOSITE/GeocodeServer"),singleLineFieldName:"SingleLine",outFields:["*"],enableSuggestions:!0,name:"Paieška",enableHighlight:!0,enableLabel:!1,localSearchOptions:{minScale:3e5,distance:5e4},placeholder:"Paieška",highlightSymbol:new G("/maps_vilnius/img/map_marker.png",36,36).setOffset(0,12)}],map:qa},"search");if(Ka.startup(),g(Ka,"select-result",function(){setTimeout(function(){popup.hide()},4e3)}),ga=new c({labels:["0 %","100 %"],value:90,minimum:0,maximum:100,intermediateChanges:!0,discreteValues:100,showButtons:!1,onChange:function(a){if("ad"===ka.currentTheme())Ma.setOpacity(a/100);else if("theme-buildings"===ka.currentTheme()||null===ka.currentTheme()||""===ka.currentTheme())Ba.setOpacity(a/100),Da.setOpacity(a/100);else for(var b in Ga)Ga.hasOwnProperty(b)&&Ga[b].setOpacity(a/100)}},"tools-opacity-widget"),ga.startup(),Ga)for(var La in Ga)Ga.hasOwnProperty(La)&&Ga[La].setOpacity(ga.value/100);switch("ad"===ka.currentTheme()||"theme-buildings"!==ka.currentTheme()&&null!==ka.currentTheme()&&""!==ka.currentTheme()||Da.setOpacity(ga.value/100),ka.currentTheme("theme")){case"ad":var Ma=permitsTheme(qa);qa.on("layer-add-result",function(a){});break;case"theme-buildings":E.add(document.body,"building-theme"),buildingsTheme(qa,Ba,Ha,ua,ka.showCursor);break;case null:E.add(document.body,"building-theme"),buildingsTheme(qa,Ba,Ha,ua,ka.showCursor);break;case"schools":y.byId("mainWindow"),new _({region:"right",style:"width: 346px; padding: 0","class":"schools",content:"<p class='build-p'>Mokyklų paieška pagal adresą:</p><div id='search-schools'></div><div id='schools-data'></div><div id='schools-info'></div>"}).placeAt("mainWindow").startup();E.add(document.body,"schools-theme"),schoolsTheme(qa,MAPCONFIG,Ha,ka.showCursor,ga)}qa.on("update-start",function(){esri.show(la)}),qa.on("update-end",function(){esri.hide(la)}),"ad"===ka.currentTheme()?qa.addLayers([Ea]):"theme-buildings"!==ka.currentTheme()&&null!==ka.currentTheme()&&""!==ka.currentTheme()||qa.addLayers([Da]),g(qa,"onZoomEnd",function(){maxOffset=ba(),La.setMaxAllowableOffset(maxOffset)}),qa.infoWindow.resize(350,400),qa.on("layers-add-result",function(a){if("ad"===ka.currentTheme()||"theme-buildings"===ka.currentTheme()||null===ka.currentTheme()||""===ka.currentTheme()){var b=function(b,c){var d=l.map(b.layerInfos,function(a,b){var d;return b!==c?void(a.defaultVisibility&&ha.push(a.id)):(d=new x({"class":"layers-labels",checked:a.defaultVisibility?"checked=checked":"",id:a.id.toString()}),a.defaultVisibility&&ha.push(a.id),inputsList=d.domNode,label=D.toDom("<label for='"+a.id+"'>"+a.name+"</label>"),inputsList.appendChild(label),tmp=document.createElement("div"),tmp.appendChild(inputsList),tmp.innerHTML)}),e=C.byId("layer-list");e.innerHTML=d.join(" "),Da.setVisibleLayers(ha),g(e,"click",ca);var f=l.map(a.layers,function(a,b){return{layer:a.layer,title:"Įjungti sluoksniai"}});f.length<2&&(legendDijit=new k({map:qa,layerInfos:f},"legend-list"),legendDijit.startup())};"ad"===ka.currentTheme()?b(Ea,0):"theme-buildings"!==ka.currentTheme()&&null!==ka.currentTheme()&&""!==ka.currentTheme()||b(Da,1)}});for(var Na=document.getElementsByTagName("a"),Oa=0;Oa<Na.length;Oa++)Na[Oa].addEventListener("click",da,!1);var Pa=new Date,Qa=Pa.getFullYear();document.getElementById("credits").innerHTML=Qa+" m. | VMS interaktyvūs žemėlapiai | <a href='http://www.vilniausplanas.lt/' target='_blank'>SĮ „Vilniaus planas“</a>";var Ra=[Ba,Ca];ka.showCursor(Ra,l)});var permitsTheme=function(a){var b;return require(["dojo/on","esri/dijit/Popup","esri/dijit/PopupTemplate","esri/InfoTemplate","dojo/promise/all","dojo/Deferred","esri/tasks/query","esri/tasks/QueryTask","esri/request","dojo/dom","dojo/dom-construct","dojo/dom-class","esri/renderers/ClassBreaksRenderer","esri/symbols/SimpleFillSymbol","esri/symbols/SimpleMarkerSymbol","esri/renderers/SimpleRenderer","esri/symbols/SimpleLineSymbol","esri/Color","esri/geometry/Extent","app/clusterfeaturelayer","esri/graphic","esri/graphicsUtils","dojo/dom-style","dojo/_base/fx","dojo/fx/easing","esri/layers/LayerInfo"],function(c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B){function C(a){var b,c="",d=a.length;if(d>1)for(var e=0;e<d;e++)b="<p></i><a href='"+a[e].url+"' target='blank'>"+a[e].icon+"</a></p>",c+=b;else"Dokumentų nėra"===a[0]&&(b="<p><i class='fa fa-exclamation'></i><span>"+a[0]+"</span></p>",c+=b);return l.byId("ad-attachment").innerHTML=c,a}function D(){clearTimeout(X),X=setTimeout(function(){var b,c=a.infoWindow.selectedIndex;if(c!==-1){b=a.infoWindow.features[c],I(),a.infoWindow._lastSelected=new w(b.toJson()),a.infoWindow._lastSelected.setSymbol(P),a.graphics.add(a.infoWindow._lastSelected);var d=H(b);d.then(function(a){})}},50)}function E(a){var b=new h,c=new i;c.returnGeometry=!1,c.outFields=["ID","VLN_REKLAMOS_ID","CONTENTTYPE","TITLE "],c.where="VLN_REKLAMOS_ID = '"+a+"'";var d;return d=new j("http://zemelapiai.vplanas.lt/arcgis/rest/services/Interaktyvus_zemelapis/Reklamos_registro_leidimai/MapServer/1"),b.resolve({query:c,task:d}),b.promise}function F(a){Y=setTimeout(function(){Q.length=0,window.clearTimeout(Y);var b="http://www.vilnius.lt/isorei/isorinereklama/files/",c=a.features;if(0!==c.length)for(var d=function(){runURL=function(a){C.call(null,Q)},setTimeout(function(){runURL(Q)},500)},e=0;e<c.length;e++){var f=a.features[e].attributes.CONTENTTYPE,g=parseInt(a.features[e].attributes.VLN_REKLAMOS_ID,10),h=a.features[e].attributes.TITLE,i=b+g+"_"+h,j={url:i,icon:G(f)};Q.push(j),d()}else Q=["Dokumentų nėra"],runURL=function(a){C.call(null,Q)},setTimeout(function(){runURL(Q)},50);return Q},1e3)}function G(a){var b="",c=a.split("/"),d=c.length,e=c[d-1];switch(e){case"pdf":b="<i class='fa fa-file-pdf-o' aria-hidden='true'></i>";break;case"vnd.openxmlformats-officedocument.wordprocessingml.document":b="<i class='fa fa-file-word-o' aria-hidden='true'></i>";break;case"vnd.lt.archyvai.adoc-2008":b="<i class='fa fa-file-word-o' aria-hidden='true'></i>";break;case"vnd.ms-excel":b="<i class='fa fa-file-excel-o' aria-hidden='true'></i>";break;case"jpeg":b="<i class='fa fa-file-image-o' aria-hidden='true'></i>";break;default:b="<i class='fa fa-file-o' aria-hidden='true'></i>"}return b}function H(b){var c,d=new h;n.contains("ad-popup","invalid-ad")?n.remove("ad-popup","invalid-ad"):n.contains("ad-popup","valid-ad")&&n.remove("ad-popup","valid-ad");var e=b.attributes.GALIOJA,f=b.attributes.ID;if(f&&e){var g=E(f);g.then(function(a){setTimeout(function(){a.task.execute(a.query,F),d.resolve(a)},100)}),1===e||3===e?(a.infoWindow.setTitle("Galiojantis reklamos registro leidimas "),N.setTitle("Galiojantis reklamos registro leidimas "),c=n.contains("ad-popup","invalid-ad")?n.remove("ad-popup","invalid-ad"):n.add("ad-popup","valid-ad"),n.add("ad-popup","valid-ad")):2===e&&(a.infoWindow.setTitle("Negaliojantis reklamos registro leidimas "),N.setTitle("Negaliojantis reklamos registro leidimas "),c=n.contains("ad-popup","valid-ad")?n.remove("ad-popup","valid-ad"):n.add("ad-popup","invalid-ad"),n.add("ad-popup","invalid-ad"))}return d.promise}function I(){a.infoWindow._lastSelected&&(a.graphics.remove(a.infoWindow._lastSelected),a.infoWindow._lastSelected=null)}function J(a,b,c){var d;a&&(a.setAttribute("fill-opacity",b),a.setAttribute("stroke-opacity",c),d=a.nextElementSibling,d&&"text"===d.nodeName&&d.setAttribute("fill-opacity",1))}function K(){y.set(a.infoWindow.domNode,"opacity",0),z.fadeIn({node:a.infoWindow.domNode,duration:150,easing:A.quadIn}).play()}var L=l.byId("loading-gif");a.on("update-start",function(){esri.show(L)}),a.on("update-end",function(){esri.hide(L)}),a.on("click",function(a){});var M,N,O,P,Q=[];popup=a.infoWindow,popup.highlight=!1,popup.titleInBody=!1,N=new f,N.setContent("<ul><li>${DATA:DateFormat(selector: 'date', fullYear: true)}<br><span>Leidimo data</span></li><li>${GALIOJA_IKI:DateFormat(selector: 'date', fullYear: true)}<br><span>Galioja iki</span></li><li>${ADRESAS}<br><span>Adresas</span></li><li>${SENIUNIJA}<br><span>Seniūnija</span></li><li>${UZSAKOVAS}<br><span>Užsakovas</span></li><li>${UZSAKOVO_KODAS}<br><span>Užsakovo kodas</span></li></ul><p>Dokumentai atsisiųsti:</p><div id='ad-attachment'><p style='text-align: center;'><img src='http://vilniausplanas.lt/maps_vilnius/img/ajax-loader.gif' style=' width: 20px;    text-align: Center;    margin: 0 auto;'></p></div><p>${SHOWS}<br><span>Reg. nr.</span></p><p>${REKLAMOS_TIPAS}<br><span>Reklamos Tipas</span></p><p>${TURINYS}<br><span>Turinys</span></p><p>${REKLAMOS_PLOTAS}<br><span>Plotas m <sup>2</sup></span></p>"),P=new q("circle",24,new s(s.STYLE_LONGDASH,new t([223,52,59,1]),3),new t([255,255,255,0]));var R,S,T,U,V,W;R=new v({url:"http://zemelapiai.vplanas.lt/arcgis/rest/services/Interaktyvus_zemelapis/Reklamos_registro_leidimai/MapServer/0",distance:30,id:"clusters",labelColor:"#484848",resolution:a.extent.getWidth()/a.width,singleTemplate:N,useDefaultSymbol:!1,maxSingles:2e3,zoomOnClick:!0,showSingles:!0,outFields:["*"]}),S=new o(O,"clusterCount"),T=new q("circle",30,new s(s.STYLE_SOLID,new t([255,210,75,.4]),15),new t([255,210,75,.85])),U=new q("circle",40,new s(s.STYLE_SOLID,new t([255,210,75,.4]),15),new t([255,210,75,.85])),V=new q("circle",50,new s(s.STYLE_SOLID,new t([255,210,75,.4]),15),new t([255,210,75,.75])),W=new q("circle",60,new s(s.STYLE_SOLID,new t([255,210,75,.4]),15),new t([255,210,75,.85])),S.addBreak(2,50,T),S.addBreak(50,250,U),S.addBreak(250,1e3,V),S.addBreak(1e3,5e4,W),R.setRenderer(S),a.addLayer(R),c(R,"click",function(b){R.geometry=b.mapPoint,pxWidth=a.extent.getWidth()/a.width,padding=30*pxWidth,qGeom=new u({xmin:R.geometry.x-padding,ymin:R.geometry.y-padding,xmax:R.geometry.x+padding,ymax:R.geometry.y+padding,spatialReference:R.geometry.spatialReference}),R.geometry=qGeom});var X,Y;return a.infoWindow.on("selection-change",function(){D(),K()}),a.infoWindow.on("hide",function(){J(M,.75,.5),I()}),b=R}),b},buildingsTheme=function(a,b,c,d,e){require(["dijit/TooltipDialog","dijit/popup","dojo/mouse","dojo/_base/connect","esri/toolbars/navigation","esri/config","dojo/on","dojo/query","esri/layers/ArcGISTiledMapServiceLayer","esri/layers/ArcGISDynamicMapServiceLayer","esri/dijit/Legend","dojo/_base/array","dojo/parser","esri/dijit/Popup","esri/dijit/PopupTemplate","esri/InfoTemplate","esri/layers/FeatureLayer","dojo/_base/declare","dojo/promise/all","dojo/Deferred","dgrid/OnDemandGrid","dgrid/Selection","dojo/store/Memory","dijit/form/CheckBox","esri/tasks/query","esri/tasks/QueryTask","esri/symbols/SimpleMarkerSymbol","esri/renderers/SimpleRenderer","esri/Color","esri/request","dojo/dom","dojo/dom-construct","dojo/dom-class","esri/symbols/SimpleFillSymbol","esri/renderers/ClassBreaksRenderer","esri/dijit/Measurement","esri/units","esri/dijit/Geocoder","esri/symbols/SimpleLineSymbol","esri/geometry/Extent","app/clusterfeaturelayer","esri/graphic","esri/graphicsUtils","dojo/dom-style","dojo/_base/fx","dojo/fx/easing","dijit/registry","esri/dijit/Scalebar","esri/layers/LayerInfo","js/photoswipe.min.js","js/photoswipe-ui-default.min.js","dijit/layout/TabContainer","dijit/layout/BorderContainer","dijit/layout/ContentPane","dojo/domReady!"],function(f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$,_,aa,ba){function ca(d){dijit.byId("selection-list")&&dijit.byId("selection-list").destroy(),window.location.hash="#close";var e=a.getMaxZoom()-1;a.centerAndZoom(d.mapPoint,e),ia.geometry=d.mapPoint,ha.execute(ia,da).then(function(){ga.createSelection()}),b.selectFeatures(ia,b.SELECTION_NEW),setTimeout(function(){window.location.hash="#build-data",c.deactivate()},100)}function da(h){function i(){switch(P){case 1:Q="Savivaldybės paskirtas administratorius";break;case 2:Q="Bendrija";break;case 3:Q="JVS";break;case 6:Q="Bendrija (statybos)";break;case 8:Q="Nenustatyta valdymo forma";break;case 9:Q="Neprižiūrimi pastatai";break;default:Q="Nėra duomenų"}return Q}function j(){var b;l(a,"mouse-move",function(a){Ta&&("undefined"!=typeof b&&b.destroy(),b=new f({id:"myTooltipDialogCompare",style:"width: 160px;",content:"<p>Pažymėkite kitą pastatą palyginimui</p>",onMouseEnter:function(){g.close(b)}}),b.startup(),g.open({popup:b,x:a.pageX+10,y:a.pageY+10}))}),l(a,"mouse-out",function(){"undefined"!=typeof b&&b.destroy()})}function k(){function f(b){window.location.hash="#close";var d=a.getMaxZoom()-1;a.centerAndZoom(b.mapPoint,d),o.geometry=b.mapPoint,n.execute(o,g),i.selectFeatures(o,i.SELECTION_NEW),c.deactivate()}function g(a){var b=a.features[0].attributes;for(var c in b)if(b.hasOwnProperty(c)){b[c]||(b[c]="Nėra duomenų",Ga=b)}var d,e,f,g,h,i,j;j=b.NTRUNKNR,d=b.ADRESAS,admC=b.ADMTARIF,f=b.BENDR_PLOT,e=b.ADMINISTR,g=b.ATLKMAX,h=b.NTPTMAX,i=b.NSPTMAX,Sa="undefined"==typeof Sa?Sa="Nėra duomenų":Sa;var k=s(j);k.then(function(a){var b="<div id='build-inner-stat-adm' class='section group animate'> <div class='colu span_1_of_3'><p ></p></div><div class='colu span_1_of_3 first-build'> <p><span>JŪSŲ PASTATAS</span></p></div> <div class='colu span_1_of_3 second-build'> <p><span>PASTATAS PALYGINIMUI</span></p></div><div class='colu span_1_of_3'><p class='normalf'>Adresas: </p></div> <div class='colu span_1_of_3' style='background: #F7F7F7;'><p>"+z+"</p></div><div class='colu span_1_of_3' style='background: #F7F7F7;'> <p>"+d+"</p></div><div class='colu span_1_of_3'><p class='normalf'>Žymėjimas: </p></div> <div class='colu span_1_of_3' style='background: #F7F7F7;'><p><span class='box first'></span></p> </div> <div class='colu span_1_of_3' style='background: #F7F7F7;'> <p><span class='box second'></span></p></div><div class='colu span_1_of_3'><p class='normalf'>Valdytojas: </p></div> <div class='colu span_1_of_3 vald' style='background: #F7F7F7;'><p>"+A+"</p> </div> <div class='colu span_1_of_3 vald' style='background: #F7F7F7;'> <p>"+e+"</p></div><div class='colu span_1_of_3'><p class='normalf'>Bendras plotas <br><b> (m²)</b>: </p> </div> <div class='colu span_1_of_3' style='background: #F7F7F7;'><p>"+I+"</p> </div> <div class='colu span_1_of_3' style='background: #F7F7F7;'> <p>"+f+"</p></div><div class='colu span_1_of_3'> <p class='normalf'>Administracinis tarifas <br><b> (Eur/m²)</b>:</p> </div> <div class='colu span_1_of_3' style='background: #F7F7F7;'> <p>"+xa+"</p> </div> <div class='colu span_1_of_3' style='background: #F7F7F7;'> <p>"+admC+"</p></div><div class='colu span_1_of_3'> <p class='normalf'>Atliekų tarifas <b> (Eur/m²)</b>:</p> </div> <div class='colu span_1_of_3' style='background: #F7F7F7;'> <p>"+(null===da?"Nėra duomenų":da)+"</p> </div><div class='colu span_1_of_3' style='background: #F7F7F7;'> <p>"+g+"</p> </div> <div class='colu span_1_of_3'> <p class='normalf'>Techninės priežiūros tarifas <b> (Eur/m²)</b>:</p></div><div class='colu span_1_of_3' style='background: #F7F7F7;'><p>"+(null===pa?"Nėra duomenų":pa)+"</p> </div> <div class='colu span_1_of_3' style='background: #F7F7F7;'> <p>"+h+"</p></div> <div class='colu span_1_of_3'> <p class='normalf'>Šildymo sistemų priežiūros tarifas <b> (Eur/m²)</b>: </p> </div><div class='colu span_1_of_3' style='background: #F7F7F7;'><p>"+(null===sa?"Nėra duomenų":sa)+"</p> </div> <div class='colu span_1_of_3' style='background: #F7F7F7;'> <p>"+i+"</p></div><div class='colu span_1_of_3'> <p class='normalf'>Šildymo s. vidutinė mėn. šildymo kaina <b> (Eur/m²)</b>: </p> </div> <div class='colu span_1_of_3' style='background: #F7F7F7;'> <p>"+Sa+"</p> </div> <div class='colu span_1_of_3' style='background: #F7F7F7;'> <p>"+a+"</p></div>";J.byId("build-inner-stat-table").innerHTML=b,window.location.hash="#build-statistics"})}L.add("myBarChart","hide"),L.remove("myBarChart","show"),L.add("bar-legend","hide"),L.remove("bar-legend","show"),Ta=!0,window.location.hash="#close",L.add("start-compare","hide"),L.remove("start-compare","show"),L.add("bar-tips","hide"),L.remove("bar-tips","show"),tooltipCompare=j();var h=J.byId("stats-close");h.addEventListener("click",function(){Ta=!1,L.add("myBarChart","show"),L.remove("myBarChart","hide"),L.remove("start-compare","hide"),L.add("start-compare","show"),L.remove("bar-legend","hide"),L.add("bar-legend","show"),L.remove("bar-tips","hide"),L.add("bar-tips","show"),window.location.hash="#build-data",a.removeLayer(i),i={},J.byId("build-inner-stat-table").innerHTML="",b.enableMouseEvents()},!1),b.disableMouseEvents();var i=new v(d,{id:"buildings-compare",mode:v.MODE_ONDEMAND,outFields:["*"]}),k=new M(M.STYLE_SOLID,new R(R.STYLE_SOLID,new H([88,23,179,1]),3),new H([129,183,206,0]));i.setSelectionSymbol(k);var m=new M(M.STYLE_SOLID,new R(R.STYLE_SOLID,new H([78,78,78,0]),1),new H([195,219,159,0]));i.setRenderer(new G(m)),a.addLayer(i);var n=new E("http://zemelapiai.vplanas.lt/arcgis/rest/services/TESTAVIMAI/Pastatu_administravimas_test/MapServer/1"),o=new D;o.outSpatialReference={wkid:3346},o.returnGeometry=!1,o.outFields=["*"],e([i],q),l(i,"click",f)}function m(a,b){var c=new XMLHttpRequest;c.open("HEAD",a,!0),c.send(),c.onreadystatechange=function(){if(4===c.readyState)return 404===c.status?(Xa+=1,console.log(Xa),o(b,a),!1):(Wa+=1,n(b,a),!0)}}function n(a,b){var c=document.createElement("p"),d=document.getElementById("build-inner-d");switch(a){case"ilgalaikisPlanas":Ya.messagePlanas="<i class='fa fa-file-pdf-o'></i> <a href='"+b+"' target='_blank'>Ilgalaikis planas</a>",
c.innerHTML=Ya.messagePlanas,d.appendChild(c);break;case"ukinisPlanas":Ya.messageUPlanas="<i class='fa fa-file-pdf-o'></i> <a href='"+b+"' target='_blank'>Ūkinis planas</a>",c.innerHTML=Ya.messageUPlanas,d.appendChild(c);break;case"metineVeiklosAtaskaita":Ya.messageAtaskaita="<i class='fa fa-file-pdf-o'></i> <a href='"+b+"' target='_blank'>"+w+" m. metinė veiklos ataskaita</a>",c.innerHTML=Ya.messageAtaskaita,d.appendChild(c)}}function o(a,b){var c=document.createElement("p"),d=document.getElementById("build-inner-d");switch(a){case"ilgalaikisPlanas":Ya.messagePlanas="<i class='fa fa-exclamation'></i>Nėra ilgalaikio plano duomenų",c.innerHTML=Ya.messagePlanas,d.appendChild(c);break;case"ukinisPlanas":Ya.messageUPlanas="<i class='fa fa-exclamation'></i>Nėra ūkinio plano duomenų",c.innerHTML=Ya.messageUPlanas,d.appendChild(c);break;case"metineVeiklosAtaskaita":Ya.messageAtaskaita="<i class='fa fa-exclamation'></i>Nėra metinės veiklos ataskaitos duomenų",c.innerHTML=Ya.messageAtaskaita,d.appendChild(c)}}function p(a){var b=a.features,c=0;if(b.length>0)for(c;c<b.length;c+=1){var d="";d+=c,$a+="<p><span class='anchor-tag' href='' onclick='attachmentsObj["+c+"]("+c+")'>"+b[c].attributes.att_title+"</span></p>",attachmentsObj[d]=function(a){for(var c=b[a].attributes.att_contentType,d=atob(b[a].attributes.att_encodedContent),e="Aktas: "+b[a].attributes.att_title,f=new Array(d.length),g=0;g<d.length;g++)f[g]=d.charCodeAt(g);var h=new Uint8Array(f),i=new Blob([h],{type:c});saveAs(i,e)}}var e="<h3>"+z+"<br></h3>"+(""===$a?"<p>Priežiūros aktų nėra</p>":"<p>Atsisiųskite priežiūros aktus: </p>"+$a);J.byId("build-inner-att").innerHTML=e}function r(a){var b=0,c=a.length,d=0;for(b;b<c;b+=1){if(a[b]&&"undefined"!=typeof a)return!0;d+=1}}function s(a){var b=new y;ka.where="NTRUNKNR = '"+a+"'",ka.returnGeometry=!1,ka.outFields=["*"];var c=ja.execute(ka);return c.then(function(a){var c=t(a);c.then(function(a){return b.resolve(a)})}),b.promise}function t(a){var b=new y,c=null;return setTimeout(function(){var d;if("undefined"==typeof a.features[0])jb=!1,c="Nėra duomenų",b.resolve(c);else{jb=!0;var e=a.features[0].attributes.METAIMAX,f=a.features,g=e,h=e-1,i=e-2,j=[],k={};k.einamiejiMetai=e;for(var l,m,n,o,p,q,r,s=0,t=f.length;s<t;s+=1){var v=a.features[s].attributes.SEZONAS;if(v===g||v===h||v===i)switch(j.push(v),l=a.features[s].attributes.SPAL_K,m=a.features[s].attributes.LAPKR_K,n=a.features[s].attributes.GRUOD_K,o=a.features[s].attributes.SAUS_K,p=a.features[s].attributes.VASAR_K,q=a.features[s].attributes.KOVAS_K,r=a.features[s].attributes.BALAN_K,v){case g:k.paskutiniaiMetai=[l,m,n,o,p,q,r];break;case h:k.viduriniaiMetai=[l,m,n,o,p,q,r];break;case i:k.galiniaiMetai=[l,m,n,o,p,q,r]}}var w=[k.paskutiniaiMetai,k.viduriniaiMetai,k.galiniaiMetai,k.einamiejiMetai];d=function(a){u.apply(null,a)},setTimeout(function(){d(w)},50),Ta?k.paskutiniaiMetai=c="undefined"==typeof k.paskutiniaiMetai?"Nėra duomenų":(k.paskutiniaiMetai.reduce(function(a,b){return a+b})/7).toFixed(3):(Sa=k.paskutiniaiMetai.reduce(function(a,b){return a+b}),Sa=(Sa/7).toFixed(3)),b.resolve(c)}},50),b.promise}function u(a,b,c,d){function e(){l(dojo.byId("build-temp-bt"),"click",function(){var a=document.getElementById("myChart-heating").getContext("2d");window.myLineHeating=new Chart(a).Line(i,j,{responsive:!1});var b=myLineHeating.generateLegend();J.byId("chart-legend-heating").innerHTML="<p><b>ŠILUMOS GRAFIKAS:</b></p><p>Vidutinė mėnesinė šildymo kaina EUR/m²</p>"+b})}var f=d+1,g=d,h=d-1,i={labels:["Spalis","Lapkritis","Gruodis","Sausis","Vasaris","Kovas","Balandis"],datasets:[{label:g+"-"+f+" m. vidutinė šildymo kaina  EUR/m²",fillColor:"rgba(151, 187, 205, 0.6)",strokeColor:"rgba(151, 187, 205, 1)",pointColor:"rgba(151, 187, 205, 1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(151,187,205,1)",data:a},{label:h+"-"+g+" m. vidutinė šildymo kaina EUR/m²",fillColor:"rgba(154, 195, 146, 0.6)",strokeColor:"rgba(154, 195, 146, 1)",pointColor:"rgba(154, 195, 146, 1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(220, 220, 220, 1)",data:b},{label:h-1+"-"+h+" m. vidutinė šildymo kaina EUR/m²",fillColor:"rgba(222, 135, 71, 0.6)",strokeColor:"rgba(222, 135, 71, 1)",pointColor:"rgba(222, 135, 71, 1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(222, 135, 71, 1)",data:c}]},j={scaleShowGridLines:!0,scaleShowLabels:!0,scaleGridLineColor:"rgba(0,0,0,.05)",scaleGridLineWidth:1,scaleShowHorizontalLines:!0,scaleShowVerticalLines:!0,bezierCurve:!0,bezierCurveTension:.4,pointDot:!0,pointDotRadius:6,pointDotStrokeWidth:1,pointHitDetectionRadius:20,datasetStroke:!0,datasetStrokeWidth:2,datasetFill:!1,tooltipCornerRadius:2,multiTooltipTemplate:"<%= value %> Eur/m² ",legendTemplate:'<div class="<%=name.toLowerCase()%>-legend"><% for (var i=0; i<datasets.length; i += 1){%><p><span style="background-color:<%=datasets[i].fillColor%>"></span><%if(datasets[i].label){%><%=datasets[i].label%><%}%></p><%}%></div>'};e()}"undefined"!=typeof myLine&&myLine.destroy(),"undefined"!=typeof myLineHeating&&myLineHeating.destroy();var w,x,z,A,B,C,F,I,K,N,O,P,Q,S,T,U,V,W,X,Y,Z,$,_,aa,ba,ca,da,ea,fa,ha,ia,la,ma,na,oa,pa,qa,ra,sa,ta,ua,va,wa,xa,ya,za,Aa,Ba,Ca,Da,Ea,Fa=h.features[0].attributes,Ga={};for(var Ha in Fa)if(Fa.hasOwnProperty(Ha)){Fa[Ha]||("ATLKMAX"==Ha||"ATLKMID"==Ha||"ATLKMIN"==Ha||"LTPTMAX"==Ha||"LTPTMID"==Ha||"LTPTMIN"==Ha||"NTPTMAX"==Ha||"NTPTMID"==Ha||"NTPTMIN"==Ha||"KITMAX"==Ha||"KITMID"==Ha||"KITMIN"==Ha||"LKITMAX"==Ha||"LKITMID"==Ha||"LKITMIN"==Ha||"NSPTMAX"==Ha||"NSPTMID"==Ha||"NSPTMIN"==Ha?Ga=Fa:(Fa[Ha]="Nėra duomenų",Ga=Fa))}w=Fa.METAIMAX,x="Nėra duomenų"==Fa.A_ADMINIKI?"Nėra duomenų":Fa.A_ADMINIKI_T,z=Fa.ADRESAS,B="Nėra duomenų"==Fa.STATMET?"Nėra duomenų":Fa.STATMET+" metai",C=Fa.STATPASK,F=Fa.NR_PLANE,I=Fa.BENDR_PLOT,N=Fa.NAUD_PLOT,K=Fa.PATALPUGSK,O="Nėra duomenų"==Fa.PATALPUNSK?"Nėra":Fa.PATALPUNSK,xa="Nėra duomenų"==Fa.ADMTARIF?"Nėra duomenų":Fa.ADMTARIF,ya="Nėra duomenų"==Fa.SKL_PLOT?"Nėra duomenų":Fa.SKL_PLOT+" a",za=Fa.SAV_TEISES,Aa=Fa.NTRUNKNR,Ba=Aa.toString().substr(0,4)+"-"+Aa.toString().substr(4,4)+"-"+Aa.toString().substr(8),A=Fa.ADMINISTR,P=Fa.VALDFORM,Q=i(),S=Fa.A_ADRES,T=Fa.A_PASKPAGR,U=Fa.A_VADOVAS,V=Fa.A_VADTEL,W=Fa.NPVADYB,X=Fa.A_VADYBTEL,Y=Fa.A_ELPAST,Z=Fa.A_KODAS,$="Nėra duomenų"==Fa.SKUNDUSK?"Nėra duomenų":Fa.SKUNDUSK+" vnt.",_=Fa.SKUNDPOB,aa="Nėra duomenų"==Fa.ENEFKL?"Nėra duomenų":Fa.ENEFKL+" klasė",ba="Nėra duomenų"==Fa.RENOVMET?"Nėra duomenų":Fa.RENOVMET+" metai",ca=Fa.RENOVUOTA,da=Fa.ATLKMAX,ea=Fa.ATLKMID,fa=Fa.ATLKMIN,ha=Fa.LTPTMAX,ia=Fa.LTPTMAX,la=Fa.LTPTMID,ma=Fa.LTPTMIN,pa=Fa.NTPTMAX,oa=Fa.NTPTMID,na=Fa.NTPTMIN,sa=Fa.NSPTMAX,ra=Fa.NSPTMID,qa=Fa.NSPTMIN,wa="Nėra duomenų"==Fa.SUKAUPTA?"Nėra duomenų":Fa.SUKAUPTA+" Eur",va=Fa.KITMAX,ua=Fa.KITMID,ta=Fa.KITMIN,kaupTar=null===va?"Nėra duomenų":va+" Eur/m²",Ca=Fa.NTPRIZ,Da=Fa.NSPRIZ,Ea=Fa.LTPRIZ;var Ia=[fa,ea,da],Ja=[ma,la,ia],Ka=[na,oa,pa],La=[qa,ra,sa],Ma="<h3>"+z+"</h3><p>"+Ba+"<br><span>Unikalus numeris</span></p><p>"+B+"<br><span>Statybos metai</span></p><p>"+F+"<br><span>Korpusas</span></p><p>"+C+"<br><span>Namo paskirtis</span></p><p class='build-bt build-top'><a href='#build-info' class='animate'>Bendroji informacija</a></p><p class='build-bt'><a href='#build-manage' class='animate'>Valdytojų informacija</a></p><p class='build-bt'><a href='#build-temp' id='build-temp-bt' class='animate'>Šildymo duomenys / Renovacija</a></p><p class='build-bt'><a href='#build-maintenance' class='animate'>Namo priežiūros tarifai</a></p><p class='build-bt'><a href='#build-docs' class='animate'>Ataskaitos ir planai</a></p><p class='build-bt'><a href='#build-attachments' class='animate'>Priežiūros aktai</a></p><p class='build-bt'><a href='#build-statistics' class='animate'>Tarifų palyginimas</a></p><p class='build-bt'><a href='#build-help' class='animate'>Pagalba ir duomenų suvedimas</a></p><p class='build-bt'><a href='#build-imp-info' class='animate'>Svarbi informacija</a></p>";J.byId("build-inner").innerHTML=Ma;var Na="<h3>"+z+"</h3><p>"+I+" m²<br><span>Bendras plotas</span></p><p>"+N+" m²<br><span>Naudingasis plotas</span></p><p>"+K+"<br><span>Gyvenamų patalpų skaičius</span></p><p>"+O+"<br><span>Negyvenamų patalpų skaičius</span></p><p>"+ya+"<br><span>Sklypo plotas arais</span></p><p>"+za+"<br><span>Namui priskirto žemės sklypo patalpų savivinkų teisės</span></p>";J.byId("build-inner-i").innerHTML=Na;var Oa="<h3>"+z+"<br></h3><p>"+Q+" <br><span>Valdymo forma</span></p><p>"+A+" <br><span>administratorius</span></p><p>"+x+" <br><span>administratoriaus paskyrimo terminas</span></p><p>"+S+"<br><span><span class='bnov'>BNOV (Bendrojo naudojimo objektų valdytojas)</span> adresas</span></p><p>"+T+"<br><span> Vilniaus miesto savivaldybės administracijos įsakymas</span></p><p>"+U+"<br><span><span class='bnov'>BNOV</span> vadovas</span></p><p>"+V+"<br><span><span class='bnov'>BNOV</span> vadovo telefonas</span></p><p>"+W+"<br><span>Namo priežiūros vadybininkas:</span></p><p style='display:none;'>"+X+"<br><span>Namo priežiūros vadybininko telefonas</span></p><p>"+$+"<br><span><span class='bnov'>BNOV</span> gaunamų skundų skaičius</span></p><p>"+_+"<br><span><span class='bnov'>BNOV</span> gaunamų skundų pobūdis</span></p><p>"+Z+" <br><span><span class='bnov'>BNOV</span> kodas</span></p><p><a href='mailto:"+Y+"' class='email'>"+Y+"</a><br><span><span class='bnov'>BNOV</span> el. paštas</span></p><p class='info-highlight'><i class='fa fa-exclamation' style='color: #C1272D;'></i>Informacija apie <a href='http://www.vilnius.lt/index.php?4265980094' class='email' target='_blank'>bendrijų steigimą</a></p>";J.byId("build-inner-mng").innerHTML=Oa;var Pa="<h3>"+z+"<br></h3><p>"+aa+"<br><span>Namo energetinis efektyvumas</span></p><p>"+ba+"<br><span>Renovacijos metai</span></p><p>"+ca+"<br><span>Kas renovuota</span></p>";J.byId("build-inner-t-msg").innerHTML=Pa;var Qa="<h3>"+z+"</h3><p>"+Ca+"<br><span>Namo techninis prižiūrėtojas</span></p><p>"+Da+"<br><span>Namo šildymo sistemos techinis prižiūrėtojas</span></p><p>"+Ea+"<br><span>Lifto techninis prižiūrėtojas</span></p><p>"+("number"==typeof xa?xa+" Eur/m²":xa)+"<br><span>Administracinis tarifas</span></p><p>"+kaupTar+"<br><span>Kaupiamosios įmokos tarifas</span></p><p>"+wa+"<br><span>Sukauptos lėšos</span></p>";J.byId("build-inner-m-msg").innerHTML=Qa;var Ra="<h3>"+z+"</h3><h4>Dviejų pastatų palyginimas:</h4><div id='compare-btn-block'><span id='start-compare' class='compare'><p>Norėdami  palyginti du skirtingu pastatus, spūstelkite žemiau esantį mygtuką ir palyginimui žemėlapyje pažymėkite naują pastatą .</p><div id='compare-btn' class='bt animate'><a class='button'><i class='fa fa-angle-left' aria-hidden='true'></i>Pasirinkite kitą pastatą palyginimui</a></div><h4 class='border-top'>Sužinokite skirtingų administratorių tarifų vidurkius:</h4><div id='selection-list'></div></span><div id='build-inner-stat-table'></div></div><div id='bar-legend'></div><canvas id='myBarChart' width='433' height='833'></canvas><div id='bar-tips'></div>";J.byId("build-inner-stat").innerHTML=Ra;var Sa,Ta=!1,Ua=J.byId("compare-btn");Ua.addEventListener("click",k,!1);var Va={ilgalaikisPlanas:"http://zemelapiai.vplanas.lt/Statiniai/Adm_Stat/"+(parseInt(w,10)+1)+"/IP_"+Aa+".pdf",ukinisPlanas:"http://zemelapiai.vplanas.lt/Statiniai/Adm_Stat/"+(parseInt(w,10)+1)+"/P_"+Aa+".pdf",metineVeiklosAtaskaita:"http://zemelapiai.vplanas.lt/Statiniai/Adm_Stat/"+(parseInt(w,10)+1)+"/AT_"+Aa+".pdf"},Wa=0,Xa=0,Ya={messagePlanas:"",messageUPlanas:"",messageAtaskaita:""};for(var Za in Va)Va.hasOwnProperty(Za)&&m(Va[Za],Za);window.attachmentsObj={};var $a="",_a=new E("http://zemelapiai.vplanas.lt/arcgis/rest/services/TESTAVIMAI/Pastatu_administravimas_test/MapServer/5"),ab=new D;ab.outSpatialReference={wkid:3346},ab.where="fld_unikalus_nr1= '"+Aa+"' OR fld_unikalus_nr2= '"+Aa+"' OR fld_unikalus_nr3= '"+Aa+"'",ab.returnGeometry=!1,ab.outFields=["*"],_a.execute(ab,p);var bb="<h3>"+z+"<br></h3>";J.byId("build-inner-d").innerHTML=bb;var cb="<h3>"+z+"<br></h3><p>Turite pasiūlymų ar pastabų? Matote klaidų?</p> <p>Susisiekite el. paštu: <a href='mailto:pastatai@vilnius.lt'>pastatai@vilnius.lt</a></p><p>Norėdami pateikti duomenys apie konkretų pastatą, kviečiame užpildyti <a href='http://zemelapiai.vplanas.lt/Statiniai/Adm_Stat/lentele.xlsx'>duomenų suvedimo lentelę</a> ir persiųsti aukščiau nurodytu el. pašto adresu.</p><p>Informacija apie <a href='http://www.vilnius.lt/index.php?4265980094' target='_blank'>bendrijų steigimą</a></p>";J.byId("build-inner-h").innerHTML=cb;var db="<h3>"+z+"<br></h3><p><a href='http://www.vilnius.lt/index.php?4265980094' target='_blank'> Bendrijų steigimas </a></p><p><a href='http://www.vilnius.lt/index.php?1568645331' target='_blank'>Jungtinės veiklos sutarties sudarymas</a></p><p><a href='http://www.vilnius.lt/index.php?4278773191' target='_blank'>Administratoriaus keitimas</a></p>";if(J.byId("build-inner-imp-i").innerHTML=db,r(Ia)||r(Ja)||r(Ka)||r(La)){var eb={labels:[w-2+" metai",w-1+" metai",w+" metai"],datasets:[{label:"Atliekų tarifai",fillColor:"rgba(84,59,13,0.2)",strokeColor:"rgba(212,203,188,1)",pointColor:"rgba(212,203,188,1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(212,203,188,1)",data:Ia},{label:"Lifto techninės priežiūros tarifai Eur/m²",fillColor:"rgba(151, 187, 205, 0.6)",strokeColor:"rgba(151, 187, 205, 1)",pointColor:"rgba(151, 187, 205, 1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(151,187,205,1)",data:Ja},{label:"Namo techninės priežiūros tarifai Eur/m²",fillColor:"rgba(154, 195, 146, 0.6)",strokeColor:"rgba(154, 195, 146, 1)",pointColor:"rgba(154, 195, 146, 1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(220, 220, 220, 1)",data:Ka},{label:"Namo šildymo sistemų priežiūros tarifai Eur/m²",fillColor:"rgba(222, 135, 71, 0.6)",strokeColor:"rgba(222, 135, 71, 1)",pointColor:"rgba(222, 135, 71, 1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(222, 135, 71, 1)",data:La}]},fb={scaleShowGridLines:!0,scaleShowLabels:!0,scaleGridLineColor:"rgba(0,0,0,.05)",scaleGridLineWidth:1,scaleShowHorizontalLines:!0,scaleShowVerticalLines:!0,bezierCurve:!0,bezierCurveTension:.4,pointDot:!0,pointDotRadius:6,pointDotStrokeWidth:1,pointHitDetectionRadius:20,datasetStroke:!0,datasetStrokeWidth:2,datasetFill:!1,tooltipCornerRadius:2,multiTooltipTemplate:"<%= value %> Eur/m² ",legendTemplate:'<div class="<%=name.toLowerCase()%>-legend"><% for (var i=0; i<datasets.length; i += 1){%><p><span style="background-color:<%=datasets[i].fillColor%>"></span><%if(datasets[i].label){%><%=datasets[i].label%><%}%></p><%}%></div>'},gb=document.getElementById("myChart").getContext("2d");window.myLine=new Chart(gb).Line(eb,fb,{responsive:!1});var hb=myLine.generateLegend();J.byId("chart-legend").innerHTML="<p><b>TARIFŲ GRAFIKAS:</b></p>"+hb}else{var ib=document.getElementById("chart-legend");ib.innerHTML="<p>Nėra duomenų apie priežiūros tarifus</p>"}s(Aa);var jb;if(!jb){var kb=document.getElementById("chart-legend-heating");kb.innerHTML="<p>Nėra duomenų apie šilumos tarifus</p>"}setTimeout(function(){var a=dijit.byId("selection-list");a.on("change",function(a){"none"!==a?(ga.setQuery(a,A),L.add("bar-legend","show"),L.remove("bar-legend","hide"),L.add("bar-tips","show"),L.remove("bar-tips","hide")):(myBar.destroy(),L.add("bar-legend","hide"),L.remove("bar-legend","show"),L.add("bar-tips","hide"),L.remove("bar-tips","show"))})},1e3)}var ea=document.querySelectorAll(".pswp")[0],fa=document.getElementById("building-help");fa.addEventListener("click",function(){var a=[{src:"/maps_vilnius/img/help_1.png",title:"1. Adresų paieškos lauko arba navigacijos meniu (jei ieškote tiesiogiai žemėlapyje) pagalba priartinkite žemėlapio vaizdą kol matysite pastatų kontūrus",w:1408,h:828},{src:"/maps_vilnius/img/help_2.png",title:"2. Pažymėkite konkretų pastatą, dešinėje atsidarusiame lange rasite visą turimą pastato informaciją bei paryškintas potemes",w:1408,h:828},{src:"/maps_vilnius/img/help_3.png",title:'3. Norėdami palyginti pastatų tarifus, pasirinkite "Tarifų palyginimas" potemę',w:1408,h:828},{src:"/maps_vilnius/img/help_4.png",title:'4. Norėdami palyginti dviejų pastatų tarifus, spūstelkite mygtuką "Pasirinkite pastatą palyginimui" ',w:1408,h:828},{src:"/maps_vilnius/img/help_5.png",title:"5. Pelės pagalba pažymėkite naują pastatą palyginimui",w:1408,h:828},{src:"/maps_vilnius/img/help_6.png",title:'6. Pažymėjus pastatą palyginimui, dešinėje atsidarusiame lange rasite dviejų pastatų turimų tarifų lentelę. Norėdami nutraukti palyginimą spūtelkite mygtuką "Atgal"',w:1408,h:828},{src:"/maps_vilnius/img/help_7.png",title:'7. Norėdami palyginti visų administratorių pastatų tarifų vidurkius, spūstelkite opciją "Pasirinkite palyginamąjį vidutinį tarifą" bei pažymėkite konkretų tarifą ',w:1408,h:828},{src:"/maps_vilnius/img/help_8.png",title:"8. Pažymėjus konkretų tarifą grafike matysite administratorių vidutinius vidurkius. PASTABA: bendrijų ir JVS duomenis nėra tikslūs",w:1408,h:828}],b={showAnimationDuration:200,errorMsg:'<div class="pswp__error-msg"><a href="%url%" target="_blank">Įvyko klaida.</a> Atsiprašome galerija nepasiekiama.</div>',index:0},c=new aa(ea,ba,a,b);c.init()});var ga={bendrijosColor:"rgba(115, 178, 255, 1)",jvsColor:"rgba(115, 255, 223, 1)",admColor:"rgba(168, 226, 251, 1)",createSelection:function(){return require(["dijit/form/Select"],function(a){var b=new a({name:"selectGraph",options:[{label:"Pasirinkite palyginamajį vidutinį tarifą:",value:"none",selected:!0},{label:"Administracinis tarifas (Eur/m²)",value:"adm"},{label:"Techninės priežiūros tarifas (Eur/m²)",value:"tech"},{label:"Šildymo sistemų priežiūros tarifas (Eur/m²)",value:"sist"},{label:"Atliekų tarifas (Eur/m²)",value:"atl"}]},"selection-list");b.startup()})},setQuery:function(a,b){var c=new y,d=new D,e=new E("http://zemelapiai.vplanas.lt/arcgis/rest/services/TESTAVIMAI/Pastatu_administravimas_test/MapServer/4"),f=this;return d.where="1=1",d.returnGeometry=!1,d.outFields=["*"],e.execute(d).then(function(d){var e=f.showGraphData(d,a,b);c.resolve(e)}),c.promise},showGraphData:function(a,b,c){var d,e=[],f=[],g=[],h=[],i=[],j=[],k=[],l=[],m=[],n=0;for(n;n<a.features.length;n+=1)switch(d=a.features[n].attributes,e.push(d.VALDF_GR),f.push(d.VALDF_GR_T),g.push(d.Namo_administracinis),h.push(d.Atliekos),i.push(d.Tech_priez),j.push(d.Sild_sist_priez),k.push(d.Sildymas),d.VALDF_GR){case 2:l.push(this.bendrijosColor),m.push("rgba(0, 112, 255, 1)");break;case 3:l.push(this.jvsColor),m.push("rgba(0, 168, 132, 1)");break;default:l.push(this.admColor),m.push("rgba(136, 187, 216, 1)")}var o={labels:e,labelsStr:f,admT:g,atliek:h,techP:i,sildP:j,sildVid:k,bgColour:l};this.showGraphics(o,b);for(var p=0;p<myBar.datasets[0].fillColor.length;p+=1){myBar.datasets[0].bars[p].fillColor=l[p];myBar.datasets[0].bars[p].label;c===myBar.datasets[0].bars[p].label?myBar.datasets[0].bars[p].strokeColor="red":myBar.datasets[0].bars[p].strokeColor=m[p],myBar.datasets[0].bars[p].strokeWidth=1}myBar.update()},showGraphics:function(a,b){"undefined"!=typeof myBar&&myBar.destroy();var c;switch(b){case"adm":c=a.admT;break;case"tech":c=a.techP;break;case"sist":c=a.sildP;break;case"sild":c=a.sildVid;break;case"atl":c=a.atliek}var d={labels:a.labelsStr,datasets:[{fillColor:a.bgColour,borderColor:a.bgColour,borderWidth:1,highlightFill:"#F7F7F7",highlightStroke:"rgba(159, 159, 159, 0.91)",data:c,yAxisID:"y-axis-0"}]},e={scaleLineColor:"rgba(0,0,0,.4)",showScale:!0,scaleFontSize:12,scaleFontColor:"#555",scaleShowLabels:!0,scaleLabel:"<%=value%>",tooltipCornerRadius:2,tooltipTemplate:"<%= label%>: <%= value + ' Eur/m²'%>",scaleSteps:1,barValueSpacing:1,responsive:!1},f=document.getElementById("myBarChart").getContext("2d");window.myBar=new Chart(f).Bar(d,e);for(var g,h=myBar.datasets[0].fillColor.getUnique(),i=0;i<h.length;i+=1)h[i]===this.admColor&&(g="<p><span style='background-color:"+h[i]+" '></span>Administratoriai</p>"),h[i]===this.bendrijosColor&&(g+="<p><span style='background-color:"+h[i]+" '></span>Bendrijos</p>"),h[i]===this.jvsColor&&(g+="<p><span style='background-color:"+h[i]+" '></span>JVS</p>");J.byId("bar-legend").innerHTML="<div id='chart-legend'><div class='line-legend'>"+g+"</div></div>",J.byId("bar-tips").innerHTML="<div id='chart-legend'><div class='line-legend'><h5><i class='fa fa-exclamation' style='color: #C1272D; height: auto'></i>Dėl bendrijų ir JVS vidutinių tarifų:</h5><p>Bendrijų ir JVS duomenys nėra tikslūs, nes informacija apie tarifus pateikta mažiau kaip 50 proc. bendrijų arba  jungtinės veiklos sutartimi  valdomų namų.</br>Sprendimas  dėl įmokų tarifų dydžio priimamas Civilinio kodekso 4.85 straipsnyje nustatyta tvarka</p><p><i class='fa fa-exclamation' style='color: #C1272D; height: auto'></i>Duomenys atliekų tarifo grafike pateikiami neįvertinus atliekų tvarkymo paskirstymo skaičiavimo būdo. Bendrijų ir JVS valdomų daugiabučių namų butų ir kitų patalpų savininkams mokestis už atliekų tvarkymą skaičiuojamas ne tik nuo buto naudingo  ploto, bet ir nuo gyventojų skaičiaus bute. Sprendimas priimamas Civilinio kodekso 4.85 straipsnyje nustatyta tvarka.</p></div></div>"}},ha=new E("http://zemelapiai.vplanas.lt/arcgis/rest/services/TESTAVIMAI/Pastatu_administravimas_test/MapServer/1"),ia=new D;ia.outSpatialReference={wkid:3346},ia.returnGeometry=!1,ia.outFields=["*"];var ja,ka=new D;setTimeout(function(){ja=new E("http://zemelapiai.vplanas.lt/arcgis/rest/services/TESTAVIMAI/Pastatu_administravimas_test/MapServer/2")},150);var la=new M(M.STYLE_SOLID,new R(R.STYLE_SOLID,new H([193,39,45,1]),3),new H([129,183,206,0]));b.setSelectionSymbol(la);var ma=new M(M.STYLE_SOLID,new R(R.STYLE_SOLID,new H([78,78,78,0]),1),new H([195,219,159,0]));b.setRenderer(new G(ma)),a.addLayer(b),l(b,"click",ca);var na;l(b,"mouse-move",function(a){"undefined"!=typeof na&&na.destroy(),na=new f({id:"myTooltipDialog",style:"width: 160px;",content:"<p>Pažymėkite pastatą</p>",onMouseEnter:function(){g.close(na)}}),na.startup(),g.open({popup:na,padding:{x:10,y:10},x:a.pageX,y:a.pageY})}),l(b,"mouse-out",function(){na.destroy()})})};